'use strict';

var react = require('react');

var l=class{audioContext;mediaStreamSource;analyser;mediaRecorder;silenceTimeout;silenceThreshold;silenceDuration;minDecibels;onVolumeChange;onDataAvailable;isSilence;hasSoundStarted;deviceId;isRecording;constructor({onVolumeChange:e,onDataAvailable:t,silenceDuration:a=2500,silentThreshold:s=-50,minDecibels:i=-100,deviceId:r}){this.audioContext=null,this.mediaStreamSource=null,this.analyser=null,this.mediaRecorder=null,this.silenceTimeout=null,this.silenceThreshold=s,this.silenceDuration=a,this.minDecibels=i,this.onVolumeChange=e,this.onDataAvailable=t,this.isSilence=!1,this.hasSoundStarted=!1,this.deviceId=r,this.isRecording=!1;}async startRecording(){if(!this.isRecording)try{let e=await this.getAudioStream();this.setupAudioContext(e),this.setupMediaRecorder(e),this.isRecording=!0,this.checkForSilence();}catch(e){throw console.error("Error getting audio stream: name=%s, message=%s",e.name,e.message),e}}async getAudioStream(){let e=(await this.getAvailableDevices()).filter(a=>a.kind==="audioinput");if(e.length===0)throw new DOMException("No audio input device","NotFoundError");this.deviceId||(e.length===1?this.deviceId=e[0].deviceId:this.deviceId="",navigator.userAgent.indexOf("Chrome")>0&&this.deviceId===""&&(this.deviceId="default"));let t={audio:{deviceId:{exact:this.deviceId}},video:!1};return navigator.mediaDevices.getUserMedia(t)}setupAudioContext(e){this.audioContext=new AudioContext,this.mediaStreamSource=this.audioContext.createMediaStreamSource(e),this.analyser=this.audioContext.createAnalyser(),this.analyser.minDecibels=this.minDecibels,this.mediaStreamSource.connect(this.analyser);}setupMediaRecorder(e){this.mediaRecorder=new MediaRecorder(e),this.mediaRecorder.ondataavailable=t=>{var a;t.data.size>0&&this.hasSoundStarted&&((a=this.onDataAvailable)==null||a.call(this,t.data));},this.mediaRecorder.start();}async getAvailableDevices(){return await navigator.mediaDevices.enumerateDevices()}setDevice(e){this.deviceId!==e&&(this.deviceId=e,this.mediaRecorder&&this.mediaRecorder.state==="recording"&&this.stopRecording());}stopRecording(){this.isRecording&&(this.mediaRecorder&&this.hasSoundStarted&&this.mediaRecorder.state==="recording"?(this.mediaRecorder.requestData(),setTimeout(()=>{this.cleanUp();},100)):this.cleanUp(),this.silenceTimeout&&(clearTimeout(this.silenceTimeout),this.silenceTimeout=null));}cleanUp(){var e,t,a,s,i;((e=this.mediaRecorder)==null?void 0:e.state)==="recording"&&((t=this.mediaRecorder)==null||t.stop()),(s=(a=this.mediaRecorder)==null?void 0:a.stream)==null||s.getTracks().forEach(r=>r.stop()),(i=this.audioContext)==null||i.close(),this.hasSoundStarted=!1,this.isRecording=!1;}checkForSilence(){var s;if(!this.mediaRecorder)throw new Error("MediaRecorder is not available");if(!this.analyser)throw new Error("Analyser is not available");let e=this.analyser.fftSize,t=new Float32Array(e||0);this.analyser.getFloatTimeDomainData(t);let a=this.computeVolume(t);(s=this.onVolumeChange)==null||s.call(this,a),a<this.silenceThreshold?!this.silenceTimeout&&this.mediaRecorder.state!=="inactive"&&(this.silenceTimeout=setTimeout(()=>{var i;(i=this.mediaRecorder)==null||i.stop(),this.isSilence=!0,this.silenceTimeout=null;},this.silenceDuration)):(this.silenceTimeout&&(clearTimeout(this.silenceTimeout),this.silenceTimeout=null),this.isSilence&&this.mediaRecorder.state!=="recording"&&(this.mediaRecorder.start(),this.isSilence=!1),this.hasSoundStarted||(this.hasSoundStarted=!0)),requestAnimationFrame(()=>this.checkForSilence());}computeVolume(e){let t=e.reduce((i,r)=>i+r*r,0),a=Math.sqrt(t/e.length);return 20*Math.log10(a)}},m=l;var A=c=>{let{silenceDuration:e,silentThreshold:t,minDecibels:a,deviceId:s}=c,[i,r]=react.useState(null),[p,h]=react.useState(!1),[n,g]=react.useState(s);react.useEffect(()=>{let o=new m(c);return n&&o.setDevice(n),r(o),()=>{o.stopRecording();}},[e,t,a,n]);let f=react.useCallback(()=>{i==null||i.startRecording(),h(!0);},[i]),R=react.useCallback(()=>{i==null||i.stopRecording(),h(!1);},[i]),S=react.useCallback(o=>{g(o);},[]),b=react.useCallback(async()=>i==null?void 0:i.getAvailableDevices(),[i]);return {startRecording:f,stopRecording:R,setDevice:S,isRecording:p,deviceId:n,getAvailableDevices:b}},v=A;var M=v;

module.exports = M;
//# sourceMappingURL=out.js.map
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9yZWFjdC91c2VTaWxlbmNlQXdhcmVSZWNvcmRlci50cyIsIi4uLy4uL3NyYy9saWIvU2lsZW5jZUF3YXJlUmVjb3JkZXIudHMiLCIuLi8uLi9zcmMvcmVhY3QvaW5kZXgudHMiXSwibmFtZXMiOlsidXNlU3RhdGUiLCJ1c2VFZmZlY3QiLCJ1c2VDYWxsYmFjayIsIlNpbGVuY2VBd2FyZVJlY29yZGVyIiwib25Wb2x1bWVDaGFuZ2UiLCJvbkRhdGFBdmFpbGFibGUiLCJzaWxlbmNlRHVyYXRpb24iLCJzaWxlbnRUaHJlc2hvbGQiLCJtaW5EZWNpYmVscyIsImRldmljZUlkIiwic3RyZWFtIiwiZXJyIiwiYXVkaW9JbnB1dERldmljZXMiLCJkZXZpY2UiLCJjb25zdHJhaW50cyIsImV2ZW50IiwiX2EiLCJfYiIsIl9jIiwiX2QiLCJfZSIsInRyYWNrIiwiYnVmZmVyTGVuZ3RoIiwiYW1wbGl0dWRlQXJyYXkiLCJ2b2x1bWUiLCJ2YWx1ZXMiLCJzdW0iLCJ2YWx1ZSIsImF2ZXJhZ2UiLCJTaWxlbmNlQXdhcmVSZWNvcmRlcl9kZWZhdWx0IiwidXNlU2lsZW5jZUF3YXJlUmVjb3JkZXIiLCJvcHRpb25zIiwiaW5pdGlhbERldmljZUlkIiwicmVjb3JkZXIiLCJzZXRSZWNvcmRlciIsImlzUmVjb3JkaW5nIiwic2V0SXNSZWNvcmRpbmciLCJzZXREZXZpY2VJZCIsInNpbGVuY2VBd2FyZVJlY29yZGVyIiwic3RhcnRSZWNvcmRpbmciLCJzdG9wUmVjb3JkaW5nIiwic2V0RGV2aWNlIiwibmV3RGV2aWNlSWQiLCJnZXRBdmFpbGFibGVEZXZpY2VzIiwidXNlU2lsZW5jZUF3YXJlUmVjb3JkZXJfZGVmYXVsdCIsInJlYWN0X2RlZmF1bHQiXSwibWFwcGluZ3MiOiJBQUFBLE9BQVMsWUFBQUEsRUFBVSxhQUFBQyxFQUFXLGVBQUFDLE1BQW1CLFFDZ0JqRCxJQUFNQyxFQUFOLEtBQTJCLENBQ2pCLGFBRUEsa0JBRUEsU0FFQSxjQUVBLGVBRVMsaUJB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QVUsc0JBQXVCLENBQUNBLENBQVEsQ0FBQyxFQUUvRixNQUFPLENBQ0wsZUFBQU0sRUFDQSxjQUFBQyxFQUNBLFVBQUFDLEVBQ0EsWUFBQU4sRUFDQSxTQUFBMUIsRUFDQSxvQkFBQWtDLENBQ0YsQ0FDRixFQUVPQyxFQUFRZCxFRTNDZixJQUFPZSxFQUFRRCIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IHVzZVN0YXRlLCB1c2VFZmZlY3QsIHVzZUNhbGxiYWNrIH0gZnJvbSAncmVhY3QnO1xuaW1wb3J0IFNpbGVuY2VBd2FyZVJlY29yZGVyLCB7IFNpbGVuY2VBd2FyZVJlY29yZGVyT3B0aW9ucyB9IGZyb20gJy4uL2xpYi9TaWxlbmNlQXdhcmVSZWNvcmRlcic7XG5cbmNvbnN0IHVzZVNpbGVuY2VBd2FyZVJlY29yZGVyID0gKG9wdGlvbnM6IFNpbGVuY2VBd2FyZVJlY29yZGVyT3B0aW9ucykgPT4ge1xuICBjb25zdCB7IHNpbGVuY2VEdXJhdGlvbiwgc2lsZW50VGhyZXNob2xkLCBtaW5EZWNpYmVscywgZGV2aWNlSWQ6IGluaXRpYWxEZXZpY2VJZCB9ID0gb3B0aW9ucztcbiAgY29uc3QgW3JlY29yZGVyLCBzZXRSZWNvcmRlcl0gPSB1c2VTdGF0ZTxTaWxlbmNlQXdhcmVSZWNvcmRlciB8IG51bGw+KG51bGwpO1xuICBjb25zdCBbaXNSZWNvcmRpbmcsIHNldElzUmVjb3JkaW5nXSA9IHVzZVN0YXRlPGJvb2xlYW4+KGZhbHNlKTtcbiAgY29uc3QgW2RldmljZUlkLCBzZXREZXZpY2VJZF0gPSB1c2VTdGF0ZTxzdHJpbmcgfCB1bmRlZmluZWQ+KGluaXRpYWxEZXZpY2VJZCk7XG5cbiAgdXNlRWZmZWN0KCgpID0+IHtcbiAgICBjb25zdCBzaWxlbmNlQXdhcmVSZWNvcmRlciA9IG5ldyBTaWxlbmNlQXdhcmVSZWNvcmRlcihvcHRpb25zKTtcbiAgICBpZiAoZGV2aWNlSWQpIHNpbGVuY2VBd2FyZVJlY29yZGVyLnNldERldmljZShkZXZpY2VJZCk7XG4gICAgc2V0UmVjb3JkZXIoc2lsZW5jZUF3YXJlUmVjb3JkZXIpO1xuXG4gICAgcmV0dXJuICgpID0+IHtcbiAgICAgIHNpbGVuY2VBd2FyZVJlY29yZGVyLnN0b3BSZWNvcmRpbmcoKTtcbiAgICB9O1xuICB9LCBbc2lsZW5jZUR1cmF0aW9uLCBzaWxlbnRUaHJlc2hvbGQsIG1pbkRlY2liZWxzLCBkZXZpY2VJZF0pO1xuXG4gIGNvbnN0IHN0YXJ0UmVjb3JkaW5nID0gdXNlQ2FsbGJhY2soKCkgPT4ge1xuICAgIHJlY29yZGVyPy5zdGFydFJlY29yZGluZygpO1xuICAgIHNldElzUmVjb3JkaW5nKHRydWUpO1xuICB9LCBbcmVjb3JkZXJdKTtcblxuICBjb25zdCBzdG9wUmVjb3JkaW5nID0gdXNlQ2FsbGJhY2soKCkgPT4ge1xuICAgIHJlY29yZGVyPy5zdG9wUmVjb3JkaW5nKCk7XG4gICAgc2V0SXNSZWNvcmRpbmcoZmFsc2UpO1xuICB9LCBbcmVjb3JkZXJdKTtcblxuICBjb25zdCBzZXREZXZpY2UgPSB1c2VDYWxsYmFjaygobmV3RGV2aWNlSWQ6IHN0cmluZykgPT4ge1xuICAgIHNldERldmljZUlkKG5ld0RldmljZUlkKTtcbiAgfSwgW10pO1xuXG4gIGNvbnN0IGdldEF2YWlsYWJsZURldmljZXMgPSB1c2VDYWxsYmFjayhhc3luYyAoKSA9PiByZWNvcmRlcj8uZ2V0QXZhaWxhYmxlRGV2aWNlcygpLCBbcmVjb3JkZXJdKTtcblxuICByZXR1cm4ge1xuICAgIHN0YXJ0UmVjb3JkaW5nLFxuICAgIHN0b3BSZWNvcmRpbmcsXG4gICAgc2V0RGV2aWNlLFxuICAgIGlzUmVjb3JkaW5nLFxuICAgIGRldmljZUlkLFxuICAgIGdldEF2YWlsYWJsZURldmljZXMsXG4gIH07XG59O1xuXG5leHBvcnQgZGVmYXVsdCB1c2VTaWxlbmNlQXdhcmVSZWNvcmRlcjtcbiIsImV4cG9ydCB0eXBlIE9uVm9sdW1lQ2hhbmdlID0gKHZvbHVtZTogbnVtYmVyKSA9PiB2b2lkO1xuZXhwb3J0IHR5cGUgT25EYXRhQXZhaWxhYmxlID0gKGRhdGE6IEJsb2IpID0+IHZvaWQgfCB1bmRlZmluZWQ7XG5cbmV4cG9ydCBpbnRlcmZhY2UgU2lsZW5jZUF3YXJlUmVjb3JkZXJPcHRpb25zIHtcbiAgZGV2aWNlSWQ/OiBzdHJpbmc7XG4gIG1pbkRlY2liZWxzPzogbnVtYmVyO1xuICBvbkRhdGFBdmFpbGFibGU/OiBPbkRhdGFBdmFpbGFibGU7XG5cbiAgb25Wb2x1bWVDaGFuZ2U/OiBPblZvbHVtZUNoYW5nZTtcbiAgc2V0RGV2aWNlSWQ/OiAoZGV2aWNlSWQ6IHN0cmluZykgPT4gdm9pZDtcblxuICBzaWxlbmNlRHVyYXRpb24/OiBudW1iZXI7XG5cbiAgc2lsZW50VGhyZXNob2xkPzogbnVtYmVyO1xufVxuXG5jbGFzcyBTaWxlbmNlQXdhcmVSZWNvcmRlciB7XG4gIHByaXZhdGUgYXVkaW9Db250ZXh0OiBBdWRpb0NvbnRleHQgfCBudWxsO1xuXG4gIHByaXZhdGUgbWVkaWFTdHJlYW1Tb3VyY2U6IE1lZGlhU3RyZWFtQXVkaW9Tb3VyY2VOb2RlIHwgbnVsbDtcblxuICBwcml2YXRlIGFuYWx5c2VyOiBBbmFseXNlck5vZGUgfCBudWxsO1xuXG4gIHByaXZhdGUgbWVkaWFSZWNvcmRlcjogTWVkaWFSZWNvcmRlciB8IG51bGw7XG5cbiAgcHJpdmF0ZSBzaWxlbmNlVGltZW91dDogUmV0dXJuVHlwZTx0eXBlb2Ygc2V0VGltZW91dD4gfCBudWxsO1xuXG4gIHByaXZhdGUgcmVhZG9ubHkgc2lsZW5jZVRocmVzaG9sZDogbnVtYmVyO1xuXG4gIHByaXZhdGUgcmVhZG9ubHkgc2lsZW5jZUR1cmF0aW9uOiBudW1iZXI7XG5cbiAgcHJpdmF0ZSByZWFkb25seSBtaW5EZWNpYmVsczogbnVtYmVyO1xuXG4gIHByaXZhdGUgcmVhZG9ubHkgb25Wb2x1bWVDaGFuZ2U/OiBPblZvbHVtZUNoYW5nZTtcblxuICBwcml2YXRlIHJlYWRvbmx5IG9uRGF0YUF2YWlsYWJsZT86IE9uRGF0YUF2YWlsYWJsZTtcblxuICBwcml2YXRlIGlzU2lsZW5jZTogYm9vbGVhbjtcblxuICBwcml2YXRlIGhhc1NvdW5kU3RhcnRlZDogYm9vbGVhbjtcblxuICBwdWJsaWMgZGV2aWNlSWQ6IHN0cmluZyB8IHVuZGVmaW5lZDtcblxuICBwdWJsaWMgaXNSZWNvcmRpbmc6IGJvb2xlYW47XG5cbiAgY29uc3RydWN0b3Ioe1xuICAgIG9uVm9sdW1lQ2hhbmdlLFxuICAgIG9uRGF0YUF2YWlsYWJsZSxcbiAgICBzaWxlbmNlRHVyYXRpb24gPSAyNTAwLFxuICAgIHNpbGVudFRocmVzaG9sZCA9IC01MCxcbiAgICBtaW5EZWNpYmVscyA9IC0xMDAsXG4gICAgZGV2aWNlSWQsXG4gIH06IFNpbGVuY2VBd2FyZVJlY29yZGVyT3B0aW9ucykge1xuICAgIHRoaXMuYXVkaW9Db250ZXh0ID0gbnVsbDtcbiAgICB0aGlzLm1lZGlhU3RyZWFtU291cmNlID0gbnVsbDtcbiAgICB0aGlzLmFuYWx5c2VyID0gbnVsbDtcbiAgICB0aGlzLm1lZGlhUmVjb3JkZXIgPSBudWxsO1xuICAgIHRoaXMuc2lsZW5jZVRpbWVvdXQgPSBudWxsO1xuICAgIHRoaXMuc2lsZW5jZVRocmVzaG9sZCA9IHNpbGVudFRocmVzaG9sZDtcbiAgICB0aGlzLnNpbGVuY2VEdXJhdGlvbiA9IHNpbGVuY2VEdXJhdGlvbjtcbiAgICB0aGlzLm1pbkRlY2liZWxzID0gbWluRGVjaWJlbHM7XG4gICAgdGhpcy5vblZvbHVtZUNoYW5nZSA9IG9uVm9sdW1lQ2hhbmdlO1xuICAgIHRoaXMub25EYXRhQXZhaWxhYmxlID0gb25EYXRhQXZhaWxhYmxlO1xuICAgIHRoaXMuaXNTaWxlbmNlID0gZmFsc2U7XG4gICAgdGhpcy5oYXNTb3VuZFN0YXJ0ZWQgPSBmYWxzZTtcbiAgICB0aGlzLmRldmljZUlkID0gZGV2aWNlSWQ7XG4gICAgdGhpcy5pc1JlY29yZGluZyA9IGZhbHNlO1xuICB9XG5cbiAgYXN5bmMgc3RhcnRSZWNvcmRpbmcoKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgaWYgKHRoaXMuaXNSZWNvcmRpbmcpIHJldHVybjtcblxuICAgIHRyeSB7XG4gICAgICBjb25zdCBzdHJlYW0gPSBhd2FpdCB0aGlzLmdldEF1ZGlvU3RyZWFtKCk7XG4gICAgICB0aGlzLnNldHVwQXVkaW9Db250ZXh0KHN0cmVhbSk7XG4gICAgICB0aGlzLnNldHVwTWVkaWFSZWNvcmRlcihzdHJlYW0pO1xuICAgICAgdGhpcy5pc1JlY29yZGluZyA9IHRydWU7XG4gICAgICB0aGlzLmNoZWNrRm9yU2lsZW5jZSgpO1xuICAgIH0gY2F0Y2ggKGVycjogYW55KSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBnZXR0aW5nIGF1ZGlvIHN0cmVhbTogbmFtZT0lcywgbWVzc2FnZT0lcycsIGVyci5uYW1lLCBlcnIubWVzc2FnZSk7XG4gICAgICB0aHJvdyBlcnI7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBnZXRBdWRpb1N0cmVhbSgpOiBQcm9taXNlPE1lZGlhU3RyZWFtPiB7XG4gICAgY29uc3QgYXVkaW9JbnB1dERldmljZXMgPSAoYXdhaXQgdGhpcy5nZXRBdmFpbGFibGVEZXZpY2VzKCkpLmZpbHRlcigoZGV2aWNlKSA9PiBkZXZpY2Uua2luZCA9PT0gJ2F1ZGlvaW5wdXQnKTtcblxuICAgIC8vIHRocm93IGFuIGVycm9yIGlmIHRoZXJlIGlzIG5vIGF1ZGlvIGlucHV0IGRldmljZVxuICAgIGlmIChhdWRpb0lucHV0RGV2aWNlcy5sZW5ndGggPT09IDApIHRocm93IG5ldyBET01FeGNlcHRpb24oJ05vIGF1ZGlvIGlucHV0IGRldmljZScsICdOb3RGb3VuZEVycm9yJyk7XG5cbiAgICAvLyBmaW5kIG91dCB0aGUgZGVmYXVsdCBkZXZpY2VJZCB0byBzdGFydCB3aXRoXG4gICAgaWYgKCF0aGlzLmRldmljZUlkKSB7XG4gICAgICAvLyBpZiB0aGVyZSBpcyBvbmx5IG9uZSBhdWRpbyBpbnB1dCBkZXZpY2VcbiAgICAgIGlmIChhdWRpb0lucHV0RGV2aWNlcy5sZW5ndGggPT09IDEpIHRoaXMuZGV2aWNlSWQgPSBhdWRpb0lucHV0RGV2aWNlc1swXS5kZXZpY2VJZDtcbiAgICAgIGVsc2UgdGhpcy5kZXZpY2VJZCA9ICcnO1xuXG4gICAgICAvLyBJZiBtaWNyb3Bob25lIGFjY2VzcyBpcyBkaXNhYmxlZCBvbiBDaHJvbWUsIGl0IGRvZXNuJ3QgYWNjZXB0IGVtcHR5IHN0cmluZyBhcyBkZXZpY2UgbmFtZSwgb3IgeyBhdWRpbzogdHJ1ZSB9XG4gICAgICAvLyBib3RoIHdpbGwgdHJpZ2dlciBhbiBPdmVyY29uc3RyYWluZWRFcnJvci4gV2UnZCBsaWtlIGEgTm90QWxsb3dlZCBlcnJvciBpbnN0ZWFkLlxuICAgICAgaWYgKG5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZignQ2hyb21lJykgPiAwICYmIHRoaXMuZGV2aWNlSWQgPT09ICcnKSB0aGlzLmRldmljZUlkID0gJ2RlZmF1bHQnO1xuICAgIH1cblxuICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby11bmRlZlxuICAgIGNvbnN0IGNvbnN0cmFpbnRzOiBNZWRpYVN0cmVhbUNvbnN0cmFpbnRzID0ge1xuICAgICAgYXVkaW86IHtcbiAgICAgICAgZGV2aWNlSWQ6IHtcbiAgICAgICAgICBleGFjdDogdGhpcy5kZXZpY2VJZCxcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgICB2aWRlbzogZmFsc2UsXG4gICAgfTtcblxuICAgIHJldHVybiBuYXZpZ2F0b3IubWVkaWFEZXZpY2VzLmdldFVzZXJNZWRpYShjb25zdHJhaW50cyk7XG4gIH1cblxuICBwcml2YXRlIHNldHVwQXVkaW9Db250ZXh0KHN0cmVhbTogTWVkaWFTdHJlYW0pOiB2b2lkIHtcbiAgICB0aGlzLmF1ZGlvQ29udGV4dCA9IG5ldyBBdWRpb0NvbnRleHQoKTtcbiAgICB0aGlzLm1lZGlhU3RyZWFtU291cmNlID0gdGhpcy5hdWRpb0NvbnRleHQuY3JlYXRlTWVkaWFTdHJlYW1Tb3VyY2Uoc3RyZWFtKTtcbiAgICB0aGlzLmFuYWx5c2VyID0gdGhpcy5hdWRpb0NvbnRleHQuY3JlYXRlQW5hbHlzZXIoKTtcbiAgICB0aGlzLmFuYWx5c2VyLm1pbkRlY2liZWxzID0gdGhpcy5taW5EZWNpYmVscztcbiAgICB0aGlzLm1lZGlhU3RyZWFtU291cmNlLmNvbm5lY3QodGhpcy5hbmFseXNlcik7XG4gIH1cblxuICBwcml2YXRlIHNldHVwTWVkaWFSZWNvcmRlcihzdHJlYW06IE1lZGlhU3RyZWFtKTogdm9pZCB7XG4gICAgdGhpcy5tZWRpYVJlY29yZGVyID0gbmV3IE1lZGlhUmVjb3JkZXIoc3RyZWFtKTtcblxuICAgIHRoaXMubWVkaWFSZWNvcmRlci5vbmRhdGFhdmFpbGFibGUgPSAoZXZlbnQpID0+IHtcbiAgICAgIGlmIChldmVudC5kYXRhLnNpemUgPiAwICYmIHRoaXMuaGFzU291bmRTdGFydGVkKSB7XG4gICAgICAgIHRoaXMub25EYXRhQXZhaWxhYmxlPy4oZXZlbnQuZGF0YSk7XG4gICAgICB9XG4gICAgfTtcblxuICAgIHRoaXMubWVkaWFSZWNvcmRlci5zdGFydCgpO1xuICB9XG5cbiAgYXN5bmMgZ2V0QXZhaWxhYmxlRGV2aWNlcygpOiBQcm9taXNlPE1lZGlhRGV2aWNlSW5mb1tdPiB7XG4gICAgY29uc3QgZGV2aWNlcyA9IGF3YWl0IG5hdmlnYXRvci5tZWRpYURldmljZXMuZW51bWVyYXRlRGV2aWNlcygpO1xuICAgIHJldHVybiBkZXZpY2VzO1xuICB9XG5cbiAgc2V0RGV2aWNlKGRldmljZUlkOiBzdHJpbmcpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5kZXZpY2VJZCAhPT0gZGV2aWNlSWQpIHtcbiAgICAgIHRoaXMuZGV2aWNlSWQgPSBkZXZpY2VJZDtcbiAgICAgIGlmICh0aGlzLm1lZGlhUmVjb3JkZXIgJiYgdGhpcy5tZWRpYVJlY29yZGVyLnN0YXRlID09PSAncmVjb3JkaW5nJykge1xuICAgICAgICAvLyBJZiB0aGUgcmVjb3JkaW5nIGlzIHJ1bm5pbmcsIHN0b3AgaXQgYmVmb3JlIHN3aXRjaGluZyBkZXZpY2VzXG4gICAgICAgIHRoaXMuc3RvcFJlY29yZGluZygpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHN0b3BSZWNvcmRpbmcoKTogdm9pZCB7XG4gICAgaWYgKCF0aGlzLmlzUmVjb3JkaW5nKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgaWYgKFxuICAgICAgdGhpcy5tZWRpYVJlY29yZGVyICYmXG4gICAgICB0aGlzLmhhc1NvdW5kU3RhcnRlZCAmJlxuICAgICAgdGhpcy5tZWRpYVJlY29yZGVyLnN0YXRlID09PSAncmVjb3JkaW5nJ1xuICAgICkge1xuICAgICAgdGhpcy5tZWRpYVJlY29yZGVyLnJlcXVlc3REYXRhKCk7XG4gICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgdGhpcy5jbGVhblVwKCk7XG4gICAgICB9LCAxMDApOyAvLyBhZGp1c3QgdGhpcyBkZWxheSBhcyBuZWNlc3NhcnlcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5jbGVhblVwKCk7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuc2lsZW5jZVRpbWVvdXQpIHtcbiAgICAgIGNsZWFyVGltZW91dCh0aGlzLnNpbGVuY2VUaW1lb3V0KTtcbiAgICAgIHRoaXMuc2lsZW5jZVRpbWVvdXQgPSBudWxsO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgY2xlYW5VcCgpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5tZWRpYVJlY29yZGVyPy5zdGF0ZSA9PT0gJ3JlY29yZGluZycpIHtcbiAgICAgIHRoaXMubWVkaWFSZWNvcmRlcj8uc3RvcCgpO1xuICAgIH1cbiAgICB0aGlzLm1lZGlhUmVjb3JkZXI/LnN0cmVhbT8uZ2V0VHJhY2tzKCkuZm9yRWFjaCgodHJhY2spID0+IHRyYWNrLnN0b3AoKSk7XG4gICAgdGhpcy5hdWRpb0NvbnRleHQ/LmNsb3NlKCk7XG4gICAgdGhpcy5oYXNTb3VuZFN0YXJ0ZWQgPSBmYWxzZTtcbiAgICB0aGlzLmlzUmVjb3JkaW5nID0gZmFsc2U7XG4gIH1cblxuICBwcml2YXRlIGNoZWNrRm9yU2lsZW5jZSgpOiB2b2lkIHtcbiAgICBpZiAoIXRoaXMubWVkaWFSZWNvcmRlcikge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdNZWRpYVJlY29yZGVyIGlzIG5vdCBhdmFpbGFibGUnKTtcbiAgICB9XG5cbiAgICBpZiAoIXRoaXMuYW5hbHlzZXIpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignQW5hbHlzZXIgaXMgbm90IGF2YWlsYWJsZScpO1xuICAgIH1cblxuICAgIGNvbnN0IGJ1ZmZlckxlbmd0aCA9IHRoaXMuYW5hbHlzZXIuZmZ0U2l6ZTtcbiAgICBjb25zdCBhbXBsaXR1ZGVBcnJheSA9IG5ldyBGbG9hdDMyQXJyYXkoYnVmZmVyTGVuZ3RoIHx8IDApO1xuICAgIHRoaXMuYW5hbHlzZXIuZ2V0RmxvYXRUaW1lRG9tYWluRGF0YShhbXBsaXR1ZGVBcnJheSk7XG5cbiAgICBjb25zdCB2b2x1bWUgPSB0aGlzLmNvbXB1dGVWb2x1bWUoYW1wbGl0dWRlQXJyYXkpO1xuXG4gICAgdGhpcy5vblZvbHVtZUNoYW5nZT8uKHZvbHVtZSk7XG5cbiAgICBpZiAodm9sdW1lIDwgdGhpcy5zaWxlbmNlVGhyZXNob2xkKSB7XG4gICAgICBpZiAoIXRoaXMuc2lsZW5jZVRpbWVvdXQgJiYgdGhpcy5tZWRpYVJlY29yZGVyLnN0YXRlICE9PSAnaW5hY3RpdmUnKSB7XG4gICAgICAgIHRoaXMuc2lsZW5jZVRpbWVvdXQgPSBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICB0aGlzLm1lZGlhUmVjb3JkZXI/LnN0b3AoKTtcbiAgICAgICAgICB0aGlzLmlzU2lsZW5jZSA9IHRydWU7XG4gICAgICAgICAgdGhpcy5zaWxlbmNlVGltZW91dCA9IG51bGw7XG4gICAgICAgIH0sIHRoaXMuc2lsZW5jZUR1cmF0aW9uKTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgaWYgKHRoaXMuc2lsZW5jZVRpbWVvdXQpIHtcbiAgICAgICAgY2xlYXJUaW1lb3V0KHRoaXMuc2lsZW5jZVRpbWVvdXQpO1xuICAgICAgICB0aGlzLnNpbGVuY2VUaW1lb3V0ID0gbnVsbDtcbiAgICAgIH1cbiAgICAgIGlmICh0aGlzLmlzU2lsZW5jZSAmJiB0aGlzLm1lZGlhUmVjb3JkZXIuc3RhdGUgIT09ICdyZWNvcmRpbmcnKSB7XG4gICAgICAgIHRoaXMubWVkaWFSZWNvcmRlci5zdGFydCgpO1xuICAgICAgICB0aGlzLmlzU2lsZW5jZSA9IGZhbHNlO1xuICAgICAgfVxuICAgICAgaWYgKCF0aGlzLmhhc1NvdW5kU3RhcnRlZCkge1xuICAgICAgICB0aGlzLmhhc1NvdW5kU3RhcnRlZCA9IHRydWU7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKCgpID0+IHRoaXMuY2hlY2tGb3JTaWxlbmNlKCkpO1xuICB9XG5cbiAgcHJpdmF0ZSBjb21wdXRlVm9sdW1lKGFtcGxpdHVkZUFycmF5OiBGbG9hdDMyQXJyYXkpOiBudW1iZXIge1xuICAgIGNvbnN0IHZhbHVlcyA9IGFtcGxpdHVkZUFycmF5LnJlZHVjZShcbiAgICAgIChzdW0sIHZhbHVlKSA9PiBzdW0gKyB2YWx1ZSAqIHZhbHVlLFxuICAgICAgMFxuICAgICk7XG4gICAgY29uc3QgYXZlcmFnZSA9IE1hdGguc3FydCh2YWx1ZXMgLyBhbXBsaXR1ZGVBcnJheS5sZW5ndGgpOyAvLyBjYWxjdWxhdGUgcm1zXG4gICAgY29uc3Qgdm9sdW1lID0gMjAgKiBNYXRoLmxvZzEwKGF2ZXJhZ2UpOyAvLyBjb252ZXJ0IHRvIGRCXG4gICAgcmV0dXJuIHZvbHVtZTtcbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBTaWxlbmNlQXdhcmVSZWNvcmRlcjtcbiIsImltcG9ydCB1c2VTaWxlbmNlQXdhcmVSZWNvcmRlciBmcm9tICcuL3VzZVNpbGVuY2VBd2FyZVJlY29yZGVyJztcblxuZXhwb3J0IGRlZmF1bHQgdXNlU2lsZW5jZUF3YXJlUmVjb3JkZXI7XG4iXX0=